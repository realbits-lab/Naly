# PWA Technical Specification

## Overview

This document defines the technical specifications and requirements for implementing Progressive Web App (PWA) functionality in the Naly application.

## Background

Progressive Web Apps combine the best of web and native apps, offering:

- **Installability**: Users can add the app to their home screen
- **Offline Support**: App continues to function without network connectivity
- **Performance**: Faster load times through intelligent caching
- **Engagement**: Push notifications and app-like experience
- **Cross-Platform**: Single codebase works across all devices

## Technical Stack

- **Framework**: Next.js 16.0.3
- **Architecture**: App Router
- **PWA Library**: `@ducanh2912/next-pwa`
- **Deployment**: Vercel (HTTPS ✓)

## Technical Requirements

### 1. Web App Manifest

**Location**: `/public/manifest.json`

**Required Configuration**:

```json
{
  "name": "Naly",
  "short_name": "Naly",
  "description": "Your app description",
  "start_url": "/",
  "display": "standalone",
  "background_color": "#ffffff",
  "theme_color": "#000000",
  "orientation": "portrait-primary",
  "icons": [
    {
      "src": "/icons/icon-72x72.png",
      "sizes": "72x72",
      "type": "image/png",
      "purpose": "any maskable"
    },
    {
      "src": "/icons/icon-96x96.png",
      "sizes": "96x96",
      "type": "image/png",
      "purpose": "any maskable"
    },
    {
      "src": "/icons/icon-128x128.png",
      "sizes": "128x128",
      "type": "image/png",
      "purpose": "any maskable"
    },
    {
      "src": "/icons/icon-144x144.png",
      "sizes": "144x144",
      "type": "image/png",
      "purpose": "any maskable"
    },
    {
      "src": "/icons/icon-152x152.png",
      "sizes": "152x152",
      "type": "image/png",
      "purpose": "any maskable"
    },
    {
      "src": "/icons/icon-192x192.png",
      "sizes": "192x192",
      "type": "image/png",
      "purpose": "any maskable"
    },
    {
      "src": "/icons/icon-384x384.png",
      "sizes": "384x384",
      "type": "image/png",
      "purpose": "any maskable"
    },
    {
      "src": "/icons/icon-512x512.png",
      "sizes": "512x512",
      "type": "image/png",
      "purpose": "any maskable"
    }
  ]
}
```

**Purpose**: Defines app metadata for installation and configures app name, icons, theme colors, and display mode.

### 2. Service Worker

**Auto-generated by**: next-pwa during build
**Location**: `/public/sw.js` (git-ignored, generated at build time)

**Required Functionality**:
- **Caching Strategy**: Cache-first for static assets, network-first for dynamic content
- **Offline Fallback**: Show offline page when network is unavailable
- **Background Sync**: Queue failed requests for retry when connection restored
- **Cache Management**: Clean up old caches on updates

**Current Strategy**:
- Cache-first for static assets (JS, CSS, images)
- Network-first for dynamic content (API calls)
- Aggressive front-end navigation caching

### 3. PWA Metadata

**Location**: `src/app/layout.tsx`

**Required Metadata**:

```tsx
export const metadata = {
  manifest: '/manifest.json',
  themeColor: '#000000',
  appleWebApp: {
    capable: true,
    statusBarStyle: 'default',
    title: 'Naly',
  },
  viewport: {
    width: 'device-width',
    initialScale: 1,
    maximumScale: 1,
    userScalable: false,
  },
};
```

**Purpose**: Configures PWA behavior and appearance across different platforms.

### 4. App Icons

**Location**: `/public/icons/`

**Required Sizes**:
- 72x72px
- 96x96px
- 128x128px
- 144x144px
- 152x152px
- 192x192px (minimum for PWA)
- 384x384px
- 512x512px (required for splash screen)

**Requirements**:
- Format: PNG (recommended over SVG)
- Both regular and maskable versions
- Apple touch icons for iOS
- Transparent or themed background

**Current Status**: Placeholder SVG icons with "N" letter (need replacement for production)

### 5. Offline Experience

**Location**: `/src/app/offline/page.tsx`

**Requirements**:
- User-friendly offline notification
- Cached for immediate availability
- Clear messaging about connectivity status
- Guidance for users on what to do

### 6. HTTPS Requirement

**Status**: ✓ Enabled on Vercel
**Requirement**: All resources must be served over HTTPS (required for PWAs)

## Success Criteria

The PWA implementation must meet the following criteria:

- ✓ Application is installable on major browsers and platforms
- ✓ Lighthouse PWA audit score ≥ 90
- ✓ App functions offline with meaningful fallback
- ✓ Service worker successfully caches and serves resources
- ✓ Users can install app from browser with custom install prompt
- ✓ All icons display correctly across platforms
- ✓ Splash screen appears on launch
- ✓ Theme color applies correctly

## Best Practices for 2025

### 1. Security
- Ensure all resources are served over HTTPS (required for PWAs)
- Implement Content Security Policy (CSP)
- Validate service worker scope

### 2. Performance
- Optimize Core Web Vitals:
  - **LCP** (Largest Contentful Paint) < 2.5s
  - **FID** (First Input Delay) < 100ms
  - **CLS** (Cumulative Layout Shift) < 0.1
- Minimize service worker size
- Use efficient caching strategies

### 3. Responsive Design
- Ensure app works on all screen sizes
- Test on mobile, tablet, and desktop
- Support landscape and portrait orientations

### 4. Accessibility
- Maintain WCAG 2.1 AA compliance
- Ensure keyboard navigation works
- Provide proper ARIA labels

### 5. Updates
- Implement smooth update mechanism without disrupting user experience
- Add skip waiting logic for updates
- Notify users of available updates

### 6. User Experience
- Fast initial load (< 3s on 3G)
- Instant response to user interactions
- Meaningful offline experience
- Clear installation prompts

## Platform Requirements

### Chrome Desktop
- Manifest validation
- Service worker registration
- Install icon in address bar

### Chrome Android
- Add to Home Screen prompt
- Splash screen support
- Standalone display mode

### Safari iOS
- Apple-specific meta tags
- Apple touch icons
- Home screen icon support

## Priority

**Medium-High** - PWAs are standard in 2025 and significantly improve user experience and engagement metrics.

## References

- [MDN Progressive Web Apps](https://developer.mozilla.org/en-US/docs/Web/Progressive_web_apps)
- [MDN PWA Best Practices](https://developer.mozilla.org/en-US/docs/Web/Progressive_web_apps/Guides/Best_practices)
- [Web.dev PWA Checklist](https://web.dev/pwa-checklist/)
- [Web App Manifest Spec](https://developer.mozilla.org/en-US/docs/Web/Manifest)

## Compliance Standards

- **PWA Criteria**: Must meet all installability criteria
- **Security**: HTTPS-only
- **Performance**: Core Web Vitals green
- **Accessibility**: WCAG 2.1 AA
- **Browser Support**: Chrome, Safari, Firefox, Edge
